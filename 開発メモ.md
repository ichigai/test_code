# 概要

TermuxでFlaskサーバーを立てれないか？という実験
~~Flutterのアプリ化が面倒すぎるので~~

## 目的

GPXログ・写真をマップに表示したい。
Termuxでサーバーを立てることで、Python＋Html＋Javascriptで実装できる？
(Flutter・Android Appの仕様が、ローカルのファイルを表示するのにあまりにも面倒＆Flutter/Dartの学習コストが高すぎる)

## 艦橋構築

F-dridでインストール
`pkg upgrade`コマンドを実行し、ライブラリをすべて更新する。

中のファイルは独立しており、通常のAndroidフォルダから見れない。
Androidの「フォルダ」アプリ、USB接続してエクスプローラーで開いても見れない。
GitHub経由で送るのが吉。

`termux-setup-storage`コマンドを実行し、フォルダに触る権限を付与する。

## python環境構築

`pkg install python`コマンドでPythonをインストール。
[Python - Termux wiki](https://wiki.termux.com/wiki/Python)
ライブラリはいつもの`pip install XXX`でインストール可能。
ただ、`numpy`や`opencv`等の一部ライブラリはTermuxのコマンドを使う。
例：`pkg install python-numpy`

`folium`ライブラリをInstallしたとき、「This error originates from a subprocess, and is likely not a problem with pip」エラーが出てきた
➡️依存したライブラリnumpyが入っていなかったことが原因。`pkg`コマンドでnumpyをインストールして解決。

## ウィジェットから起動

Androidのホーム画面からTermuxのスクリプトを起動する方法
Termux-Widgetを使い、Widgetから起動できる。

1. F-Droidから「Termux:Widget」をインストール
2. Androidの設定で→アプリ→Termuxを開き、「他のアプリの上に重ねて表示」を許可する
3. Termuxのホームディレクトリを開く(/data/data/com.termux/files/home/)
4. `.shortcut`フォルダを作成＆実行権限を付与
   1. `mkdir -p /data/data/com.termux/files/home/.shortcuts`
   2. `chmod 700 -R /data/data/com.termux/files/home/.shortcuts`
   3. `.`付きのフォルダなため、通常の`ls`では見えない。`ls -a`で確認を。
5. `.shortcut`フォルダへ移動し、必要な.shファイルを作成する。
6. Androidのホーム画面を開き、ウィジェット一覧からTermux:Widgetを選び、ホーム画面にセット
   1. 1x1のやつは、`.shortcut`フォルダ内のスクリプトのどれか1つを選択
   2. 2x2のやつは、`.shortcut`フォルダ内のスクリプトが一覧で出てくる。
7. 6.のウィジェットをタップし、.shを実行。

`python /data/data/com.termux/files/home/storage/~.py`の一行だけで、保存した好きなPythonファイルを実行できる。

[参考](https://github.com/termux/termux-widget)